#
# Copyright 2024 Valkyrie Systems Corporation
#
# Licensed under MIT License.  See LICENSE.
#
import itertools
import logging

import pytest

import sarpy.io.product.sidd2_elements.ExploitationFeatures as ef2


SINGLE_SICD_POLS = ('V', 'H', 'RHC', 'LHC', 'OTHER')
POLS = SINGLE_SICD_POLS + ('UNKNOWN',)

@pytest.mark.parametrize(('txpol', 'rcvpol'), itertools.product(POLS, POLS))
def test_txrcvpolarization(txpol, rcvpol, caplog):
    with caplog.at_level(logging.INFO, 'sarpy.io.xml.descriptors'):
        ef2.TxRcvPolarizationType(TxPolarization=txpol, RcvPolarization=rcvpol)
        assert not caplog.records


@pytest.mark.parametrize(('txpol', 'rcvpol'), itertools.product(SINGLE_SICD_POLS, SINGLE_SICD_POLS))
def test_txrcvpolarization_from_sicd_nominal(txpol, rcvpol):
    sicd_str = f'{txpol}:{rcvpol}'
    txp = ef2.TxRcvPolarizationType.from_sicd_value(sicd_str)
    assert txp.TxPolarization == txpol
    assert txp.RcvPolarization == rcvpol


@pytest.mark.parametrize(('sicd_str', 'expected'), 
                         [(None, ('UNKNOWN', 'UNKNOWN')),
                          ('OTHER', ('OTHER', 'OTHER')),
                          ('UNKNOWN', ('UNKNOWN', 'UNKNOWN')),
                          ('X:Y', ('OTHER', 'OTHER')),
                          ('E:S', ('OTHER', 'OTHER')),
                          ('OTHER_CUSTOM1:OTHER_CUSTOM2', ('OTHER', 'OTHER')),
                         ])
def test_txrcvpolarization_from_sicd_other(sicd_str, expected):
    txp = ef2.TxRcvPolarizationType.from_sicd_value(sicd_str)
    assert txp.TxPolarization == expected[0]
    assert txp.RcvPolarization == expected[1]


def test_txrcvpolarization_from_sicd_error():
    with pytest.raises(TypeError):
        ef2.TxRcvPolarizationType.from_sicd_value(0)

